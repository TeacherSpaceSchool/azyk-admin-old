{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"C:\\\\projects\\\\azyk\\\\azyk-admin\\\\layouts\\\\App.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport AppBar from '../components/app/AppBar';\nimport Dialog from '../components/app/Dialog';\nimport SnackBar from '../components/app/SnackBar';\nimport Drawer from '../components/app/Drawer';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { addFavoriteItem } from '../src/gql/items';\nimport { addBasket } from '../src/gql/basket';\nimport * as paginationActions from '../redux/actions/pagination';\nimport * as userActions from '../redux/actions/user';\nimport * as appActions from '../redux/actions/app';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss';\nimport Router from 'next/router';\nimport { useRouter } from 'next/router';\nimport { useBottomScrollListener } from 'react-bottom-scroll-listener';\nexport var mainWindow = React.createRef();\nvar App = React.memo(function (props) {\n  var _props$userActions = props.userActions,\n      setProfile = _props$userActions.setProfile,\n      logout = _props$userActions.logout;\n  var _props$paginationActi = props.paginationActions,\n      next = _props$paginationActi.next,\n      disable = _props$paginationActi.disable;\n  var showLoad = props.appActions.showLoad;\n  var _props$user = props.user,\n      profile = _props$user.profile,\n      authenticated = _props$user.authenticated;\n  var _props$pagination = props.pagination,\n      work = _props$pagination.work,\n      count = _props$pagination.count;\n  var sorts = props.sorts,\n      filters = props.filters,\n      getList = props.getList,\n      pageName = props.pageName,\n      dates = props.dates,\n      subcategory = props.subcategory,\n      category = props.category;\n  var router = useRouter();\n  useEffect(function () {\n    if (authenticated) setProfile();else if (!authenticated && profile.role) logout(false);\n  }, [authenticated]);\n  Router.events.on('routeChangeStart', function (err, url) {\n    if (!router.pathname.includes(url)) showLoad(true);\n\n    if (err.cancelled) {\n      showLoad(false);\n    }\n  });\n  var containerRef = useBottomScrollListener(function () {\n    if (work) next();\n  });\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var favorites, basket, i;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(authenticated && profile.role === 'client')) {\n                _context.next = 23;\n                break;\n              }\n\n              if (!(localStorage.favorites && localStorage.favorites !== '[]')) {\n                _context.next = 10;\n                break;\n              }\n\n              favorites = JSON.parse(localStorage.favorites);\n              favorites = favorites.map(function (element) {\n                return element._id;\n              });\n              _context.next = 6;\n              return addFavoriteItem(favorites);\n\n            case 6:\n              localStorage.favorites = _JSON$stringify([]);\n\n              if (!(getList !== undefined)) {\n                _context.next = 10;\n                break;\n              }\n\n              _context.next = 10;\n              return getList();\n\n            case 10:\n              if (!(localStorage.basket && localStorage.basket !== '[]')) {\n                _context.next = 23;\n                break;\n              }\n\n              basket = JSON.parse(localStorage.basket);\n              i = 0;\n\n            case 13:\n              if (!(i < basket.length)) {\n                _context.next = 19;\n                break;\n              }\n\n              _context.next = 16;\n              return addBasket({\n                item: basket[i].item._id,\n                count: basket[i].count\n              });\n\n            case 16:\n              i++;\n              _context.next = 13;\n              break;\n\n            case 19:\n              localStorage.basket = '[]';\n\n              if (!(getList !== undefined)) {\n                _context.next = 23;\n                break;\n              }\n\n              _context.next = 23;\n              return getList();\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, []);\n  var load = props.app.load;\n  return __jsx(\"div\", {\n    ref: mainWindow,\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70\n    },\n    __self: this\n  }, __jsx(Drawer, {\n    subcategory: subcategory,\n    category: category,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71\n    },\n    __self: this\n  }), __jsx(AppBar, {\n    dates: dates,\n    pageName: pageName,\n    sorts: sorts,\n    filters: filters,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    ref: containerRef,\n    className: \"App-body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }, props.children), __jsx(Dialog, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }), __jsx(SnackBar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77\n    },\n    __self: this\n  }), load ? __jsx(\"div\", {\n    className: \"load\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }, __jsx(CircularProgress, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80\n    },\n    __self: this\n  })) : null);\n});\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    app: state.app,\n    pagination: state.pagination\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    userActions: bindActionCreators(userActions, dispatch),\n    appActions: bindActionCreators(appActions, dispatch),\n    paginationActions: bindActionCreators(paginationActions, dispatch)\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);","map":{"version":3,"sources":["C:\\projects\\azyk\\azyk-admin\\layouts\\App.js"],"names":["React","useEffect","AppBar","Dialog","SnackBar","Drawer","connect","bindActionCreators","addFavoriteItem","addBasket","paginationActions","userActions","appActions","CircularProgress","Router","useRouter","useBottomScrollListener","mainWindow","createRef","App","memo","props","setProfile","logout","next","disable","showLoad","user","profile","authenticated","pagination","work","count","sorts","filters","getList","pageName","dates","subcategory","category","router","role","events","on","err","url","pathname","includes","cancelled","containerRef","localStorage","favorites","JSON","parse","map","element","_id","undefined","basket","i","length","item","load","app","children","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport AppBar from '../components/app/AppBar'\nimport Dialog from '../components/app/Dialog'\nimport SnackBar from '../components/app/SnackBar'\nimport Drawer from '../components/app/Drawer'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport { addFavoriteItem } from '../src/gql/items'\nimport { addBasket } from '../src/gql/basket'\nimport * as paginationActions from '../redux/actions/pagination'\nimport * as userActions from '../redux/actions/user'\nimport * as appActions from '../redux/actions/app'\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss'\nimport Router from 'next/router'\nimport { useRouter } from 'next/router';\nimport { useBottomScrollListener } from 'react-bottom-scroll-listener';\n\nexport const mainWindow = React.createRef();\n\nconst App = React.memo(props => {\n    const { setProfile, logout } = props.userActions;\n    const { next, disable } = props.paginationActions;\n    const { showLoad } = props.appActions;\n    const { profile, authenticated } = props.user;\n    const { work, count } = props.pagination;\n    let { sorts, filters, getList, pageName, dates, subcategory, category } = props;\n    const router = useRouter();\n    useEffect( ()=>{\n        if(authenticated)\n            setProfile()\n        else if(!authenticated&&profile.role)\n            logout(false)\n    },[authenticated,])\n    Router.events.on('routeChangeStart', (err, url)=>{\n        if(!router.pathname.includes(url))\n            showLoad(true)\n        if (err.cancelled) {\n            showLoad(false)\n        }\n    })\n    const containerRef = useBottomScrollListener(()=>{\n        if(work) next()\n    });\n    useEffect( ()=>{\n        (async ()=>{\n            if(authenticated&&profile.role==='client'){\n                if(localStorage.favorites&&localStorage.favorites!=='[]') {\n                    let favorites = JSON.parse(localStorage.favorites)\n                    favorites = favorites.map(element => element._id)\n                    await addFavoriteItem(favorites)\n                    localStorage.favorites = JSON.stringify([])\n                    if (getList !== undefined)\n                        await getList()\n                }\n                if(localStorage.basket&&localStorage.basket!=='[]') {\n                    let basket = JSON.parse(localStorage.basket)\n                    for(let i=0; i<basket.length; i++){\n                        await addBasket({item: basket[i].item._id, count: basket[i].count})\n                    }\n                    localStorage.basket = '[]'\n                    if (getList !== undefined)\n                        await getList()\n                }\n            }\n        })()\n    },[])\n    const { load } = props.app;\n    return(\n        <div ref={mainWindow} className='App'>\n            <Drawer subcategory={subcategory} category={category}/>\n            <AppBar dates={dates} pageName={pageName} sorts={sorts} filters={filters}/>\n            <div ref={containerRef} className='App-body'>\n                {props.children}\n            </div>\n            <Dialog />\n            <SnackBar/>\n            {load?\n                <div className='load'>\n                    <CircularProgress/>\n                </div>\n                :\n                null\n            }\n        </div>\n    )\n});\n\nfunction mapStateToProps (state) {\n    return {\n        user: state.user,\n        app: state.app,\n        pagination: state.pagination\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        userActions: bindActionCreators(userActions, dispatch),\n        appActions: bindActionCreators(appActions, dispatch),\n        paginationActions: bindActionCreators(paginationActions, dispatch),\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);"]},"metadata":{},"sourceType":"module"}