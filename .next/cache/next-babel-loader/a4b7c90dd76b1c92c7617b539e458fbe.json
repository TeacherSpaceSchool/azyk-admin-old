{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { useState, useEffect } from 'react';\nimport App from '../layouts/App';\nimport { connect } from 'react-redux';\nimport pageListStyle from '../src/styleMUI/basket/basket';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport CancelIcon from '@material-ui/icons/Cancel';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport dynamic from 'next/dynamic';\nimport { bindActionCreators } from 'redux';\nimport * as mini_dialogActions from '../redux/actions/mini_dialog';\nimport * as snackbarActions from '../redux/actions/snackbar';\nimport { getBasket, setBasket, deleteBasket } from '../src/gql/basket';\nimport { getClient } from '../src/gql/client';\nimport { LazyLoadImage } from 'react-lazy-load-image-component';\nvar BuyBasket = dynamic(function () {\n  return import('../components/dialog/BuyBasket');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../components/dialog/BuyBasket')];\n    },\n    modules: ['../components/dialog/BuyBasket']\n  }\n});\nvar Sign = dynamic(function () {\n  return import('../components/dialog/Sign');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../components/dialog/Sign')];\n    },\n    modules: ['../components/dialog/Sign']\n  }\n});\nvar Confirmation = dynamic(function () {\n  return import('../components/dialog/Confirmation');\n}, {\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../components/dialog/Confirmation')];\n    },\n    modules: ['../components/dialog/Confirmation']\n  }\n});\nvar Basket = React.memo(function (props) {\n  var classes = pageListStyle();\n  var _props$mini_dialogAct = props.mini_dialogActions,\n      setMiniDialog = _props$mini_dialogAct.setMiniDialog,\n      showMiniDialog = _props$mini_dialogAct.showMiniDialog;\n  var showSnackBar = props.snackbarActions.showSnackBar;\n  var data = props.data;\n\n  var _useState = useState(data.baskets),\n      list = _useState[0],\n      setList = _useState[1];\n\n  var _useState2 = useState(0),\n      allPrice = _useState2[0],\n      setAllPrice = _useState2[1];\n\n  var isMobileApp = props.app.isMobileApp;\n  var authenticated = props.user.authenticated;\n\n  var increment = function increment(idx) {\n    list[idx].count += 1;\n    setBasketChange(idx, list[idx].count);\n    setList(_toConsumableArray(list));\n  };\n\n  var decrement = function decrement(idx) {\n    if (list[idx].count > 0) {\n      list[idx].count -= 1;\n      setBasketChange(idx, list[idx].count);\n      setList(_toConsumableArray(list));\n    }\n  };\n\n  var setBasketChange = function setBasketChange(idx, count) {\n    if (authenticated) setBasket({\n      _id: list[idx]._id,\n      count: count\n    });else {\n      var _list = JSON.parse(localStorage.basket);\n\n      _list[idx].count = count;\n      localStorage.basket = _JSON$stringify(_list);\n    }\n  };\n\n  var removeBasketChange =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(idx) {\n      var action;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              action =\n              /*#__PURE__*/\n              function () {\n                var _ref2 = _asyncToGenerator(\n                /*#__PURE__*/\n                _regeneratorRuntime.mark(function _callee() {\n                  var _list2;\n\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          if (!authenticated) {\n                            _context.next = 9;\n                            break;\n                          }\n\n                          deleteBasket([list[idx]._id]);\n                          _context.t0 = setList;\n                          _context.next = 5;\n                          return getBasket();\n\n                        case 5:\n                          _context.t1 = _context.sent.baskets;\n                          (0, _context.t0)(_context.t1);\n                          _context.next = 13;\n                          break;\n\n                        case 9:\n                          _list2 = JSON.parse(localStorage.basket);\n\n                          _list2.splice(idx, 1);\n\n                          localStorage.basket = _JSON$stringify(_list2);\n                          setList(_list2);\n\n                        case 13:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function action() {\n                  return _ref2.apply(this, arguments);\n                };\n              }();\n\n              setMiniDialog('Вы уверенны?', __jsx(Confirmation, {\n                action: action\n              }));\n              showMiniDialog(true);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function removeBasketChange(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!authenticated) {\n                if (localStorage.basket == undefined) {\n                  localStorage.basket = _JSON$stringify([]);\n                }\n\n                setList(JSON.parse(localStorage.basket));\n              }\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  }, []);\n  useEffect(function () {\n    calculateAllPrice();\n  }, [list]);\n\n  var getList =\n  /*#__PURE__*/\n  function () {\n    var _ref4 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.t0 = setList;\n              _context4.next = 3;\n              return getBasket();\n\n            case 3:\n              _context4.t1 = _context4.sent.baskets;\n              (0, _context4.t0)(_context4.t1);\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function getList() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var calculateAllPrice =\n  /*#__PURE__*/\n  function () {\n    var _ref5 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee5() {\n      var allPrice, i;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              allPrice = 0;\n\n              for (i = 0; i < list.length; i++) {\n                allPrice += (list[i].item.stock === 0 || list[i].item.stock === undefined ? list[i].item.price : list[i].item.stock) * list[i].count;\n              }\n\n              setAllPrice(allPrice);\n\n            case 3:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function calculateAllPrice() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  console.log(list);\n  return __jsx(App, {\n    getList: getList,\n    pageName: \"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\"\n  }, __jsx(Head, null, __jsx(\"title\", null, \"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\")), isMobileApp ? __jsx(\"div\", {\n    className: classes.column,\n    style: {\n      width: 'calc(100% - 16px)',\n      margin: 8\n    }\n  }, list.map(function (row, idx) {\n    return __jsx(Card, {\n      className: classes.page,\n      key: idx\n    }, __jsx(CardActions, {\n      className: classes.column,\n      style: isMobileApp ? {} : {\n        justifyContent: 'start',\n        alignItems: 'flex-start'\n      }\n    }, __jsx(\"div\", {\n      className: classes.itemM\n    }, __jsx(\"div\", {\n      className: classes.divImage\n    }, __jsx(LazyLoadImage, {\n      effect: \"blur\",\n      className: classes.mediaM,\n      src: row.item.image\n    }), __jsx(IconButton, {\n      onClick: function onClick() {\n        removeBasketChange(idx);\n      },\n      color: \"primary\",\n      className: classes.cancelM\n    }, __jsx(CancelIcon, {\n      style: {\n        height: 40,\n        width: 40\n      }\n    }))), __jsx(\"br\", null), __jsx(\"div\", {\n      className: classes.nameM\n    }, row.item.name), __jsx(\"br\", null), __jsx(\"div\", {\n      className: classes.counter,\n      style: isMobileApp ? {\n        marginBottom: 20\n      } : {\n        marginRight: 20\n      }\n    }, __jsx(\"div\", {\n      className: classes.counterbtn,\n      onClick: function onClick() {\n        decrement(idx);\n      }\n    }, \"\\u2013\"), __jsx(\"input\", {\n      type: \"text\",\n      className: classes.counternmbr,\n      value: row.count,\n      onChange: function onChange(event) {\n        list[idx].count = isNaN(event.target.value) || event.target.value.length === 0 ? 0 : _parseInt(event.target.value);\n        setBasketChange(idx, list[idx].count);\n        setList(_toConsumableArray(list));\n      }\n    }), __jsx(\"div\", {\n      className: classes.counterbtn,\n      onClick: function onClick() {\n        increment(idx);\n      }\n    }, \"+\")), __jsx(\"div\", null, __jsx(\"div\", {\n      className: classes.row\n    }, __jsx(\"div\", {\n      className: classes.nameField\n    }, \"\\u0426\\u0435\\u043D\\u0430\"), __jsx(\"div\", {\n      className: classes.value\n    }, \"\".concat(row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock, \" \\u0441\\u043E\\u043C\"))), __jsx(\"div\", {\n      className: classes.row\n    }, __jsx(\"div\", {\n      className: classes.nameField\n    }, \"\\u0418\\u0442\\u043E\\u0433\\u043E\"), __jsx(\"div\", {\n      className: classes.value\n    }, \"\".concat((row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock) * row.count, \" \\u0441\\u043E\\u043C\")))))));\n  }), __jsx(\"div\", {\n    style: {\n      height: 70\n    }\n  })) : __jsx(React.Fragment, null, __jsx(Card, {\n    className: classes.page\n  }, __jsx(CardActions, {\n    className: classes.column,\n    style: isMobileApp ? {} : {\n      justifyContent: 'start',\n      alignItems: 'flex-start'\n    }\n  }, __jsx(Table, {\n    \"aria-label\": \"simple table\"\n  }, __jsx(TableHead, null, __jsx(TableRow, null, __jsx(TableCell, null), __jsx(TableCell, {\n    align: \"left\"\n  }, \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E\"), __jsx(TableCell, {\n    align: \"left\"\n  }, \"\\u0426\\u0435\\u043D\\u0430\"), __jsx(TableCell, {\n    align: \"left\"\n  }, \"\\u0418\\u0442\\u043E\\u0433\\u043E\"), __jsx(TableCell, {\n    align: \"center\"\n  }, \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"))), __jsx(TableBody, null, list.map(function (row, idx) {\n    return __jsx(TableRow, {\n      key: idx\n    }, __jsx(TableCell, {\n      component: \"th\",\n      scope: \"row\"\n    }, __jsx(\"div\", {\n      className: classes.row\n    }, __jsx(LazyLoadImage, {\n      effect: \"blur\",\n      className: classes.mediaD,\n      src: row.item.image\n    }), __jsx(\"div\", {\n      className: classes.nameD\n    }, row.item.name))), __jsx(TableCell, {\n      align: \"left\"\n    }, __jsx(\"div\", {\n      className: classes.counterD,\n      style: isMobileApp ? {\n        marginBottom: 20\n      } : {\n        marginRight: 20\n      }\n    }, __jsx(\"div\", {\n      className: classes.counterbtnD,\n      onClick: function onClick() {\n        decrement(idx);\n      }\n    }, \"\\u2013\"), __jsx(\"input\", {\n      type: \"text\",\n      className: classes.counternmbrD,\n      value: row.count,\n      onChange: function onChange(event) {\n        list[idx].count = isNaN(event.target.value) || event.target.value.length === 0 ? 0 : _parseInt(event.target.value);\n        setBasketChange(idx, list[idx].count);\n        setList(_toConsumableArray(list));\n      }\n    }), __jsx(\"div\", {\n      className: classes.counterbtnD,\n      onClick: function onClick() {\n        increment(idx);\n      }\n    }, \"+\"))), __jsx(TableCell, {\n      align: \"left\"\n    }, \"\".concat(row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock * row.count, \" \\u0441\\u043E\\u043C\")), __jsx(TableCell, {\n      align: \"left\"\n    }, \"\".concat((row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock * row.count) * row.count, \" \\u0441\\u043E\\u043C\")), __jsx(TableCell, {\n      align: \"center\"\n    }, __jsx(IconButton, {\n      onClick: function onClick() {\n        removeBasketChange(idx);\n      },\n      color: \"primary\",\n      className: classes.button,\n      \"aria-label\": \"add to shopping cart\"\n    }, __jsx(CancelIcon, null))));\n  }))))), __jsx(\"div\", {\n    style: {\n      height: 70\n    }\n  })), __jsx(\"div\", {\n    className: isMobileApp ? classes.bottomBasketM : classes.bottomBasketD\n  }, __jsx(\"div\", {\n    className: isMobileApp ? classes.allPriceM : classes.allPriceD\n  }, __jsx(\"div\", {\n    className: isMobileApp ? classes.value : classes.priceAllText\n  }, \"\\u041E\\u0431\\u0449\\u0430\\u044F \\u0441\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C\"), __jsx(\"div\", {\n    className: isMobileApp ? classes.nameM : classes.priceAll\n  }, \"\".concat(allPrice, \" \\u0441\\u043E\\u043C\"))), __jsx(\"div\", {\n    className: isMobileApp ? classes.buyM : classes.buyD,\n    onClick: function onClick() {\n      if (allPrice > 0) {\n        if (authenticated) setMiniDialog('Купить', __jsx(BuyBasket, {\n          client: data.client,\n          allPrice: allPrice\n        }));else setMiniDialog('Купить', __jsx(Sign, null));\n        showMiniDialog(true);\n      } else showSnackBar('Добавьте товар в корзину');\n    }\n  }, \"\\u041A\\u0423\\u041F\\u0418\\u0422\\u042C\")));\n});\n\nBasket.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee6(ctx) {\n    return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.t0 = _objectSpread;\n            _context6.t1 = {};\n            _context6.next = 4;\n            return getBasket();\n\n          case 4:\n            _context6.t2 = _context6.sent;\n\n            if (!ctx.store.getState().user.profile._id) {\n              _context6.next = 11;\n              break;\n            }\n\n            _context6.next = 8;\n            return getClient({\n              _id: ctx.store.getState().user.profile._id\n            });\n\n          case 8:\n            _context6.t3 = _context6.sent;\n            _context6.next = 12;\n            break;\n\n          case 11:\n            _context6.t3 = [];\n\n          case 12:\n            _context6.t4 = _context6.t3;\n            _context6.t5 = (0, _context6.t0)(_context6.t1, _context6.t2, _context6.t4);\n            return _context6.abrupt(\"return\", {\n              data: _context6.t5\n            });\n\n          case 15:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n\n  return function (_x2) {\n    return _ref6.apply(this, arguments);\n  };\n}();\n\nfunction mapStateToProps(state) {\n  return {\n    app: state.app,\n    user: state.user\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    mini_dialogActions: bindActionCreators(mini_dialogActions, dispatch),\n    snackbarActions: bindActionCreators(snackbarActions, dispatch)\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Basket);","map":null,"metadata":{},"sourceType":"module"}