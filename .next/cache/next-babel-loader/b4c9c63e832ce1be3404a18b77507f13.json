{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"C:\\\\projects\\\\azyk\\\\azyk-admin\\\\layouts\\\\App.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { getAds } from '../src/gql/ads';\nimport AppBar from '../components/app/AppBar';\nimport Dialog from '../components/app/Dialog';\nimport SnackBar from '../components/app/SnackBar';\nimport Drawer from '../components/app/Drawer';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { addFavoriteItem } from '../src/gql/items';\nimport { addBasket } from '../src/gql/basket';\nimport * as userActions from '../redux/actions/user';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss';\nexport var mainWindow = React.createRef();\nvar App = React.memo(function (props) {\n  var setProfile = props.userActions.setProfile;\n  var _props$user = props.user,\n      profile = _props$user.profile,\n      authenticated = _props$user.authenticated;\n  var sorts = props.sorts,\n      filters = props.filters,\n      getList = props.getList,\n      pageName = props.pageName;\n\n  var _useState = useState({}),\n      ads = _useState[0],\n      setAds = _useState[1];\n\n  useEffect(function () {\n    console.log(profile.role);\n    if (authenticated && !profile.role) setProfile();\n  }, [authenticated]);\n  useEffect(function () {\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var favorites, basket, i;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!authenticated) {\n                _context.next = 23;\n                break;\n              }\n\n              if (!(localStorage.favorites && localStorage.favorites !== '[]')) {\n                _context.next = 10;\n                break;\n              }\n\n              favorites = JSON.parse(localStorage.favorites);\n              favorites = favorites.map(function (element) {\n                return element._id;\n              });\n              _context.next = 6;\n              return addFavoriteItem(favorites);\n\n            case 6:\n              localStorage.favorites = _JSON$stringify([]);\n\n              if (!(getList !== undefined)) {\n                _context.next = 10;\n                break;\n              }\n\n              _context.next = 10;\n              return getList();\n\n            case 10:\n              if (!(localStorage.basket && localStorage.basket !== '[]')) {\n                _context.next = 23;\n                break;\n              }\n\n              basket = JSON.parse(localStorage.basket);\n              i = 0;\n\n            case 13:\n              if (!(i < basket.length)) {\n                _context.next = 19;\n                break;\n              }\n\n              _context.next = 16;\n              return addBasket({\n                item: basket[i].item._id,\n                count: basket[i].count\n              });\n\n            case 16:\n              i++;\n              _context.next = 13;\n              break;\n\n            case 19:\n              localStorage.basket = '[]';\n\n              if (!(getList !== undefined)) {\n                _context.next = 23;\n                break;\n              }\n\n              _context.next = 23;\n              return getList();\n\n            case 23:\n              _context.t0 = setAds;\n              _context.next = 26;\n              return getAds();\n\n            case 26:\n              _context.t1 = _context.sent.ads;\n              (0, _context.t0)(_context.t1);\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, []);\n  var load = props.app.load;\n  /*const { data: { data }, loading } = useSubscription(\n      BASKET_SUBSCRIPTION\n  );\n  console.log(data, loading)*/\n\n  return __jsx(\"div\", {\n    ref: mainWindow,\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57\n    },\n    __self: this\n  }, __jsx(AppBar, {\n    pageName: pageName,\n    sorts: sorts,\n    filters: filters,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58\n    },\n    __self: this\n  }), __jsx(Drawer, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: \"App-body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60\n    },\n    __self: this\n  }, ads && ads.url ? __jsx(\"a\", {\n    href: ads.url,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63\n    },\n    __self: this\n  }, __jsx(\"img\", {\n    src: ads.image,\n    alt: ads.title,\n    className: \"marketImg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64\n    },\n    __self: this\n  })) : null, props.children), __jsx(Dialog, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }), __jsx(SnackBar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }), load ? __jsx(\"div\", {\n    className: \"load\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  }, __jsx(CircularProgress, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  })) : null);\n});\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    app: state.app\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    userActions: bindActionCreators(userActions, dispatch)\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);","map":{"version":3,"sources":["C:\\projects\\azyk\\azyk-admin\\layouts\\App.js"],"names":["React","useEffect","useState","getAds","AppBar","Dialog","SnackBar","Drawer","connect","bindActionCreators","addFavoriteItem","addBasket","userActions","CircularProgress","mainWindow","createRef","App","memo","props","setProfile","user","profile","authenticated","sorts","filters","getList","pageName","ads","setAds","console","log","role","localStorage","favorites","JSON","parse","map","element","_id","undefined","basket","i","length","item","count","load","app","url","image","title","children","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { getAds } from '../src/gql/ads'\nimport AppBar from '../components/app/AppBar'\nimport Dialog from '../components/app/Dialog'\nimport SnackBar from '../components/app/SnackBar'\nimport Drawer from '../components/app/Drawer'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport { addFavoriteItem } from '../src/gql/items'\nimport { addBasket } from '../src/gql/basket'\nimport * as userActions from '../redux/actions/user'\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss'\n\nexport const mainWindow = React.createRef();\n\nconst App = React.memo(props => {\n    const { setProfile } = props.userActions;\n    const { profile, authenticated } = props.user;\n    let { sorts, filters, getList, pageName } = props;\n    let [ads, setAds] = useState({});\n    useEffect( ()=>{\n        console.log(profile.role)\n        if(authenticated&&!profile.role)\n            setProfile()\n    },[authenticated])\n    useEffect( ()=>{\n        (async ()=>{\n            if(authenticated){\n                if(localStorage.favorites&&localStorage.favorites!=='[]') {\n                    let favorites = JSON.parse(localStorage.favorites)\n                    favorites = favorites.map(element => element._id)\n                    await addFavoriteItem(favorites)\n                    localStorage.favorites = JSON.stringify([])\n                    if (getList !== undefined)\n                        await getList()\n                }\n                if(localStorage.basket&&localStorage.basket!=='[]') {\n                    let basket = JSON.parse(localStorage.basket)\n                    for(let i=0; i<basket.length; i++){\n                        await addBasket({item: basket[i].item._id, count: basket[i].count})\n                    }\n                    localStorage.basket = '[]'\n                    if (getList !== undefined)\n                        await getList()\n                }\n            }\n            setAds((await getAds()).ads)\n        })()\n    },[])\n    const { load } = props.app;\n    /*const { data: { data }, loading } = useSubscription(\n        BASKET_SUBSCRIPTION\n    );\n    console.log(data, loading)*/\n    return(\n        <div ref={mainWindow} className='App'>\n                <AppBar pageName={pageName} sorts={sorts} filters={filters}/>\n                <Drawer />\n                <div className='App-body'>\n                    {\n                        ads&&ads.url?\n                            <a href={ads.url}>\n                                <img\n                                    src={ads.image}\n                                    alt={ads.title}\n                                    className='marketImg'\n                                />\n                            </a>\n                            :\n                            null\n                    }\n                    {props.children}\n                </div>\n                <Dialog />\n                <SnackBar/>\n            {load?\n                <div className='load'>\n                    <CircularProgress/>\n                </div>\n                :\n                null\n            }\n        </div>\n    )\n});\n\nfunction mapStateToProps (state) {\n    return {\n        user: state.user,\n        app: state.app,\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        userActions: bindActionCreators(userActions, dispatch),\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);"]},"metadata":{},"sourceType":"module"}