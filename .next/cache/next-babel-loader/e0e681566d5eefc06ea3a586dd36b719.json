{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"C:\\\\projects\\\\azyk\\\\azyk-admin\\\\pages\\\\basket.js\";\nvar __jsx = React.createElement;\nimport Head from 'next/head';\nimport React, { useState, useEffect } from 'react';\nimport App from '../layouts/App';\nimport { connect } from 'react-redux';\nimport pageListStyle from '../src/styleMUI/basket/basket';\nimport Card from '@material-ui/core/Card';\nimport CardActions from '@material-ui/core/CardActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport CancelIcon from '@material-ui/icons/Cancel';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport { bindActionCreators } from 'redux';\nimport * as mini_dialogActions from '../redux/actions/mini_dialog';\nimport * as snackbarActions from '../redux/actions/snackbar';\nimport { getBasket, setBasket, deleteBasket } from '../src/gql/basket';\nimport { getClient } from '../src/gql/client';\nimport Router from 'next/router';\nimport BuyBasket from '../components/dialog/BuyBasket';\nimport Sign from '../components/dialog/Sign';\nimport Confirmation from '../components/dialog/Confirmation';\nconst Basket = React.memo(props => {\n  const {\n    authenticated\n  } = props.user;\n  const classes = pageListStyle();\n  const {\n    setMiniDialog,\n    showMiniDialog\n  } = props.mini_dialogActions;\n  const {\n    showSnackBar\n  } = props.snackbarActions;\n  const {\n    data\n  } = props;\n  let {\n    0: list,\n    1: setList\n  } = useState(data.baskets);\n  let {\n    0: allPrice,\n    1: setAllPrice\n  } = useState(0);\n  const {\n    isMobileApp\n  } = props.app;\n\n  let increment = idx => {\n    list[idx].count += 1;\n    setBasketChange(idx, list[idx].count);\n    setList([...list]);\n  };\n\n  let decrement = idx => {\n    if (list[idx].count > 0) {\n      list[idx].count -= 1;\n      setBasketChange(idx, list[idx].count);\n      setList([...list]);\n    }\n  };\n\n  let setBasketChange = (idx, count) => {\n    if (authenticated) setBasket({\n      _id: list[idx]._id,\n      count: count\n    });else {\n      let list = JSON.parse(localStorage.basket);\n      list[idx].count = count;\n      localStorage.basket = _JSON$stringify(list);\n    }\n  };\n\n  let removeBasketChange = async idx => {\n    const action = async () => {\n      if (authenticated) {\n        deleteBasket([list[idx]._id]);\n        setList((await getBasket()).baskets);\n      } else {\n        let list = JSON.parse(localStorage.basket);\n        list.splice(idx, 1);\n        localStorage.basket = _JSON$stringify(list);\n        setList(list);\n      }\n    };\n\n    setMiniDialog('Вы уверенны?', __jsx(Confirmation, {\n      action: action,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67\n      },\n      __self: this\n    }));\n    showMiniDialog(true);\n  };\n\n  useEffect(() => {\n    (async () => {\n      if (!authenticated) {\n        if (localStorage.basket == undefined) {\n          localStorage.basket = _JSON$stringify([]);\n        }\n\n        setList(JSON.parse(localStorage.basket));\n      }\n    })();\n  }, []);\n  useEffect(() => {\n    calculateAllPrice();\n  }, [list]);\n\n  let getList = async () => {\n    setList((await getBasket()).baskets);\n  };\n\n  let calculateAllPrice = async () => {\n    let allPrice = 0;\n\n    for (let i = 0; i < list.length; i++) {\n      allPrice += (list[i].item.stock === 0 || list[i].item.stock === undefined ? list[i].item.price : list[i].item.stock) * list[i].count;\n    }\n\n    setAllPrice(allPrice);\n  };\n\n  return __jsx(App, {\n    getList: getList,\n    pageName: \"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, __jsx(Head, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, __jsx(\"title\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, \"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430\")), isMobileApp ? __jsx(\"div\", {\n    className: classes.column,\n    style: {\n      width: 'calc(100% - 16px)',\n      margin: 8\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, list.map((row, idx) => __jsx(Card, {\n    className: classes.page,\n    key: idx,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, __jsx(CardActions, {\n    className: classes.column,\n    style: isMobileApp ? {} : {\n      justifyContent: 'start',\n      alignItems: 'flex-start'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.itemM,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.divImage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, __jsx(\"img\", {\n    className: classes.mediaM,\n    src: row.item.image,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }), __jsx(IconButton, {\n    onClick: () => {\n      removeBasketChange(idx);\n    },\n    color: \"primary\",\n    className: classes.cancelM,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, __jsx(CancelIcon, {\n    style: {\n      height: 40,\n      width: 40\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }))), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classes.nameM,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, row.item.name), __jsx(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classes.counter,\n    style: isMobileApp ? {\n      marginBottom: 20\n    } : {\n      marginRight: 20\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.counterbtn,\n    onClick: () => {\n      decrement(idx);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, \"\\u2013\"), __jsx(\"input\", {\n    type: \"text\",\n    className: classes.counternmbr,\n    value: row.count,\n    onChange: event => {\n      list[idx].count = isNaN(event.target.value) || event.target.value.length === 0 ? 0 : _parseInt(event.target.value);\n      setBasketChange(idx, list[idx].count);\n      setList([...list]);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classes.counterbtn,\n    onClick: () => {\n      increment(idx);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, \"+\")), __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.row,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.nameField,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, \"\\u0426\\u0435\\u043D\\u0430\"), __jsx(\"div\", {\n    className: classes.value,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, `${row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock} сом`)), __jsx(\"div\", {\n    className: classes.row,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.nameField,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, \"\\u0418\\u0442\\u043E\\u0433\\u043E\"), __jsx(\"div\", {\n    className: classes.value,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, `${(row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock) * row.count} сом`))))))), __jsx(\"div\", {\n    style: {\n      height: 70\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  })) : __jsx(React.Fragment, null, __jsx(Card, {\n    className: classes.page,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, __jsx(CardActions, {\n    className: classes.column,\n    style: isMobileApp ? {} : {\n      justifyContent: 'start',\n      alignItems: 'flex-start'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, __jsx(Table, {\n    \"aria-label\": \"simple table\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, __jsx(TableHead, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, __jsx(TableRow, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, __jsx(TableCell, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E\"), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, \"\\u0426\\u0435\\u043D\\u0430\"), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, \"\\u0418\\u0442\\u043E\\u0433\\u043E\"), __jsx(TableCell, {\n    align: \"center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, \"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"))), __jsx(TableBody, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, list.map((row, idx) => __jsx(TableRow, {\n    key: idx,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, __jsx(TableCell, {\n    component: \"th\",\n    scope: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.row,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, __jsx(\"img\", {\n    className: classes.mediaD,\n    src: row.item.image,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classes.nameD,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, row.item.name))), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.counterD,\n    style: isMobileApp ? {\n      marginBottom: 20\n    } : {\n      marginRight: 20\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: classes.counterbtnD,\n    onClick: () => {\n      decrement(idx);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, \"\\u2013\"), __jsx(\"input\", {\n    type: \"text\",\n    className: classes.counternmbrD,\n    value: row.count,\n    onChange: event => {\n      list[idx].count = isNaN(event.target.value) || event.target.value.length === 0 ? 0 : _parseInt(event.target.value);\n      setBasketChange(idx, list[idx].count);\n      setList([...list]);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: classes.counterbtnD,\n    onClick: () => {\n      increment(idx);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, \"+\"))), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189\n    },\n    __self: this\n  }, `${row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock * row.count} сом`), __jsx(TableCell, {\n    align: \"left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, `${(row.item.stock === 0 || row.item.stock === undefined ? row.item.price : row.item.stock * row.count) * row.count} сом`), __jsx(TableCell, {\n    align: \"center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, __jsx(IconButton, {\n    onClick: () => {\n      removeBasketChange(idx);\n    },\n    color: \"primary\",\n    className: classes.button,\n    \"aria-label\": \"add to shopping cart\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, __jsx(CancelIcon, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }))))))))), __jsx(\"div\", {\n    style: {\n      height: 70\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: isMobileApp ? classes.bottomBasketM : classes.bottomBasketD,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: isMobileApp ? classes.allPriceM : classes.allPriceD,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: isMobileApp ? classes.value : classes.priceAllText,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, \"\\u041E\\u0431\\u0449\\u0430\\u044F \\u0441\\u0442\\u043E\\u0438\\u043C\\u043E\\u0441\\u0442\\u044C\"), __jsx(\"div\", {\n    className: isMobileApp ? classes.nameM : classes.priceAll,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }, `${allPrice} сом`)), __jsx(\"div\", {\n    className: isMobileApp ? classes.buyM : classes.buyD,\n    onClick: () => {\n      if (allPrice > 0) {\n        if (authenticated) setMiniDialog('Купить', __jsx(BuyBasket, {\n          client: data.client,\n          allPrice: allPrice,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        }));else setMiniDialog('Купить', __jsx(Sign, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 215\n          },\n          __self: this\n        }));\n        showMiniDialog(true);\n      } else showSnackBar('Добавьте товар в корзину');\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, \"\\u041A\\u0423\\u041F\\u0418\\u0422\\u042C\")));\n});\n\nBasket.getInitialProps = async function (ctx) {\n  if ('client' === ctx.store.getState().user.profile.role || !ctx.store.getState().user.authenticated) if (ctx.res) {\n    ctx.res.writeHead(302, {\n      Location: '/'\n    });\n    ctx.res.end();\n  } else Router.push('/');\n  return {\n    data: _objectSpread({}, (await getBasket()), ctx.store.getState().user.profile._id ? await getClient({\n      _id: ctx.store.getState().user.profile._id\n    }) : [])\n  };\n};\n\nfunction mapStateToProps(state) {\n  return {\n    app: state.app,\n    user: state.user\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    mini_dialogActions: bindActionCreators(mini_dialogActions, dispatch),\n    snackbarActions: bindActionCreators(snackbarActions, dispatch)\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Basket);","map":{"version":3,"sources":["C:\\projects\\azyk\\azyk-admin\\pages\\basket.js"],"names":["Head","React","useState","useEffect","App","connect","pageListStyle","Card","CardActions","IconButton","CancelIcon","Table","TableBody","TableCell","TableHead","TableRow","bindActionCreators","mini_dialogActions","snackbarActions","getBasket","setBasket","deleteBasket","getClient","Router","BuyBasket","Sign","Confirmation","Basket","memo","props","authenticated","user","classes","setMiniDialog","showMiniDialog","showSnackBar","data","list","setList","baskets","allPrice","setAllPrice","isMobileApp","app","increment","idx","count","setBasketChange","decrement","_id","JSON","parse","localStorage","basket","removeBasketChange","action","splice","undefined","calculateAllPrice","getList","i","length","item","stock","price","column","width","margin","map","row","page","justifyContent","alignItems","itemM","divImage","mediaM","image","cancelM","height","nameM","name","counter","marginBottom","marginRight","counterbtn","counternmbr","event","isNaN","target","value","nameField","mediaD","nameD","counterD","counterbtnD","counternmbrD","button","bottomBasketM","bottomBasketD","allPriceM","allPriceD","priceAllText","priceAll","buyM","buyD","client","getInitialProps","ctx","store","getState","profile","role","res","writeHead","Location","end","push","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import Head from 'next/head';\r\nimport React, { useState, useEffect } from 'react';\r\nimport App from '../layouts/App';\r\nimport { connect } from 'react-redux'\r\nimport pageListStyle from '../src/styleMUI/basket/basket'\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport CancelIcon from '@material-ui/icons/Cancel';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport { bindActionCreators } from 'redux'\r\nimport * as mini_dialogActions from '../redux/actions/mini_dialog'\r\nimport * as snackbarActions from '../redux/actions/snackbar'\r\nimport { getBasket, setBasket, deleteBasket } from '../src/gql/basket';\r\nimport { getClient } from '../src/gql/client';\r\nimport Router from 'next/router'\r\nimport BuyBasket from '../components/dialog/BuyBasket'\r\nimport Sign from '../components/dialog/Sign'\r\nimport Confirmation from '../components/dialog/Confirmation'\r\n\r\nconst Basket = React.memo((props) => {\r\n    const { authenticated } = props.user;\r\n    const classes = pageListStyle();\r\n    const { setMiniDialog, showMiniDialog } = props.mini_dialogActions;\r\n    const { showSnackBar } = props.snackbarActions;\r\n    const { data } = props;\r\n    let [list, setList] = useState(data.baskets);\r\n    let [allPrice, setAllPrice] = useState(0);\r\n    const { isMobileApp } = props.app;\r\n    let increment = (idx)=>{\r\n        list[idx].count+=1\r\n        setBasketChange(idx, list[idx].count)\r\n        setList([...list])\r\n    }\r\n    let decrement = (idx)=>{\r\n        if(list[idx].count>0) {\r\n            list[idx].count -= 1\r\n            setBasketChange(idx, list[idx].count)\r\n            setList([...list])\r\n        }\r\n    }\r\n    let setBasketChange= (idx, count)=>{\r\n        if(authenticated)\r\n            setBasket({_id: list[idx]._id, count: count})\r\n        else {\r\n            let list = JSON.parse(localStorage.basket);\r\n            list[idx].count = count;\r\n            localStorage.basket = JSON.stringify(list);\r\n        }\r\n    }\r\n    let removeBasketChange= async (idx)=>{\r\n        const action = async() => {\r\n            if(authenticated) {\r\n                deleteBasket([list[idx]._id])\r\n                setList((await getBasket()).baskets)\r\n            } else {\r\n                let list = JSON.parse(localStorage.basket)\r\n                list.splice(idx, 1)\r\n                localStorage.basket = JSON.stringify(list)\r\n                setList(list)\r\n            }\r\n        }\r\n        setMiniDialog('Вы уверенны?', <Confirmation action={action}/>)\r\n        showMiniDialog(true)\r\n    }\r\n    useEffect(()=>{\r\n        (async()=>{\r\n            if(!authenticated){\r\n                if(localStorage.basket==undefined) {\r\n                    localStorage.basket = JSON.stringify([])\r\n                }\r\n                setList(JSON.parse(localStorage.basket))\r\n            }\r\n        })()\r\n    },[])\r\n    useEffect(()=>{\r\n        calculateAllPrice()\r\n    },[list])\r\n    let getList = async()=>{\r\n        setList((await getBasket()).baskets)\r\n    };\r\n    let calculateAllPrice = async()=>{\r\n        let allPrice = 0\r\n        for(let i=0;i < list.length; i++){\r\n            allPrice+=((list[i].item.stock===0||list[i].item.stock===undefined?list[i].item.price:list[i].item.stock)*list[i].count)\r\n        }\r\n        setAllPrice(allPrice)\r\n    };\r\n    return (\r\n        <App getList={getList} pageName='Корзина'>\r\n            <Head>\r\n                <title>Корзина</title>\r\n            </Head>\r\n                {\r\n                        isMobileApp?\r\n                            <div className={classes.column} style={{width: 'calc(100% - 16px)', margin: 8}}>\r\n                                {\r\n                                    list.map((row, idx) => (\r\n                                        <Card className={classes.page} key={idx}>\r\n                                            <CardActions className={classes.column} style={isMobileApp?{}:{justifyContent: 'start', alignItems: 'flex-start'}}>\r\n                                                <div className={classes.itemM}>\r\n                                                <div className={classes.divImage}>\r\n                                                    <img className={classes.mediaM} src={row.item.image}/>\r\n                                                    <IconButton onClick={()=>{removeBasketChange(idx)}} color=\"primary\" className={classes.cancelM}>\r\n                                                        <CancelIcon style={{height: 40, width: 40}} />\r\n                                                    </IconButton>\r\n                                                </div>\r\n                                                <br/>\r\n                                                <div className={classes.nameM}>\r\n                                                    {row.item.name}\r\n                                                </div>\r\n                                                <br/>\r\n                                                <div className={classes.counter} style={isMobileApp?{marginBottom: 20}:{marginRight: 20}}>\r\n                                                    <div className={classes.counterbtn} onClick={()=>{decrement(idx)}}>–</div>\r\n                                                    <input type='text' className={classes.counternmbr} value={row.count} onChange={(event)=>{\r\n                                                        list[idx].count = isNaN(event.target.value)||event.target.value.length===0?0:parseInt(event.target.value)\r\n                                                        setBasketChange(idx, list[idx].count)\r\n                                                        setList([...list])\r\n                                                    }}/>\r\n                                                    <div className={classes.counterbtn} onClick={()=>{increment(idx)}}>+</div>\r\n                                                </div>\r\n                                                <div>\r\n                                                    <div className={classes.row}>\r\n                                                        <div className={classes.nameField}>\r\n                                                            Цена\r\n                                                        </div>\r\n                                                        <div className={classes.value}>\r\n                                                            {`${row.item.stock===0||row.item.stock===undefined?row.item.price:row.item.stock} сом`}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className={classes.row}>\r\n                                                        <div className={classes.nameField}>\r\n                                                            Итого\r\n                                                        </div>\r\n                                                        <div className={classes.value}>\r\n                                                            {`${(row.item.stock===0||row.item.stock===undefined?row.item.price:row.item.stock)*row.count} сом`}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            </CardActions>\r\n                                        </Card>\r\n                                    ))\r\n                                }\r\n                                <div style={{height: 70}}/>\r\n                            </div>\r\n                            :\r\n                            <>\r\n                            <Card className={classes.page}>\r\n                                <CardActions className={classes.column} style={isMobileApp?{}:{justifyContent: 'start', alignItems: 'flex-start'}}>\r\n                                <Table aria-label=\"simple table\">\r\n                                <TableHead>\r\n                                    <TableRow>\r\n                                        <TableCell/>\r\n                                        <TableCell align=\"left\">Количество</TableCell>\r\n                                        <TableCell align=\"left\">Цена</TableCell>\r\n                                        <TableCell align=\"left\">Итого</TableCell>\r\n                                        <TableCell align=\"center\">Отменить</TableCell>\r\n                                    </TableRow>\r\n                                    </TableHead>\r\n                                    <TableBody>\r\n                                        {list.map((row, idx) => (\r\n                                            <TableRow key={idx}>\r\n                                                <TableCell component=\"th\" scope=\"row\" >\r\n                                                    <div className={classes.row}>\r\n                                                        <img className={classes.mediaD} src={row.item.image}/>\r\n                                                        <div className={classes.nameD}>\r\n                                                            {row.item.name}\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </TableCell>\r\n                                                <TableCell align=\"left\">\r\n\r\n                                                    <div className={classes.counterD} style={isMobileApp?{marginBottom: 20}:{marginRight: 20}}>\r\n                                                        <div className={classes.counterbtnD} onClick={()=>{decrement(idx)}}>–</div>\r\n                                                        <input type='text' className={classes.counternmbrD} value={row.count} onChange={(event)=>{\r\n                                                            list[idx].count = isNaN(event.target.value)||event.target.value.length===0?0:parseInt(event.target.value)\r\n                                                            setBasketChange(idx, list[idx].count)\r\n                                                            setList([...list])\r\n                                                        }}/>\r\n                                                        <div className={classes.counterbtnD} onClick={()=>{increment(idx)}}>+</div>\r\n                                                    </div>\r\n\r\n                                                </TableCell>\r\n                                                <TableCell align=\"left\">{`${row.item.stock===0||row.item.stock===undefined?row.item.price:row.item.stock*row.count} сом`}</TableCell>\r\n                                                <TableCell align=\"left\">{`${(row.item.stock===0||row.item.stock===undefined?row.item.price:row.item.stock*row.count)*row.count} сом`}</TableCell>\r\n                                                <TableCell align=\"center\">\r\n                                                    <IconButton onClick={()=>{removeBasketChange(idx)}} color=\"primary\" className={classes.button} aria-label=\"add to shopping cart\">\r\n                                                        <CancelIcon />\r\n                                                    </IconButton>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ))}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </CardActions>\r\n                            </Card>\r\n                            <div style={{height: 70}}/>\r\n                            </>\r\n                    }\r\n            <div className={isMobileApp?classes.bottomBasketM:classes.bottomBasketD}>\r\n                <div className={isMobileApp?classes.allPriceM:classes.allPriceD}>\r\n                    <div className={isMobileApp?classes.value:classes.priceAllText}>Общая стоимость</div>\r\n                    <div className={isMobileApp?classes.nameM:classes.priceAll}>{`${allPrice} сом`}</div>\r\n                </div>\r\n                <div className={isMobileApp?classes.buyM:classes.buyD} onClick={()=>{\r\n                    if(allPrice>0) {\r\n                        if (authenticated)\r\n                            setMiniDialog('Купить', <BuyBasket client={data.client} allPrice={allPrice}/>)\r\n                        else\r\n                            setMiniDialog('Купить', <Sign/>)\r\n                        showMiniDialog(true)\r\n                    } else\r\n                        showSnackBar('Добавьте товар в корзину')\r\n                }}>\r\n                    КУПИТЬ\r\n                </div>\r\n            </div>\r\n        </App>\r\n    )\r\n})\r\n\r\nBasket.getInitialProps = async function(ctx) {\r\n\r\n    if('client'===ctx.store.getState().user.profile.role||!ctx.store.getState().user.authenticated)\r\n        if(ctx.res) {\r\n            ctx.res.writeHead(302, {\r\n                Location: '/'\r\n            })\r\n            ctx.res.end()\r\n        } else\r\n            Router.push('/')\r\n    return {\r\n        data: {\r\n            ...await getBasket(),\r\n            ...(ctx.store.getState().user.profile._id?await getClient({_id: ctx.store.getState().user.profile._id}):[])\r\n        }\r\n    };\r\n};\r\n\r\nfunction mapStateToProps (state) {\r\n    return {\r\n        app: state.app,\r\n        user: state.user,\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return {\r\n        mini_dialogActions: bindActionCreators(mini_dialogActions, dispatch),\r\n        snackbarActions: bindActionCreators(snackbarActions, dispatch),\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Basket);"]},"metadata":{},"sourceType":"module"}