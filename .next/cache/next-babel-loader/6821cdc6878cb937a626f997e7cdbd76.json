{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nvar _jsxFileName = \"C:\\\\projects\\\\azyk\\\\azyk-admin\\\\layouts\\\\App.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport AppBar from '../components/app/AppBar';\nimport Dialog from '../components/app/Dialog';\nimport SnackBar from '../components/app/SnackBar';\nimport Drawer from '../components/app/Drawer';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { addFavoriteItem } from '../src/gql/items';\nimport { addBasket } from '../src/gql/basket';\nimport * as userActions from '../redux/actions/user';\nimport * as appActions from '../redux/actions/app';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss';\nimport Router from 'next/router';\nimport { useRouter } from 'next/router';\nexport const mainWindow = React.createRef();\nconst App = React.memo(props => {\n  const {\n    setProfile,\n    logout\n  } = props.userActions;\n  const {\n    showLoad\n  } = props.appActions;\n  const {\n    profile,\n    authenticated\n  } = props.user;\n  let {\n    sorts,\n    filters,\n    getList,\n    pageName,\n    dates,\n    subcategory,\n    category\n  } = props;\n  const router = useRouter();\n  useEffect(() => {\n    if (authenticated) setProfile();else if (!authenticated && profile.role) logout(false);\n  }, [authenticated]);\n  Router.events.on('routeChangeStart', (err, url) => {\n    if (!router.pathname.includes(url)) showLoad(true);\n\n    if (err.cancelled) {\n      showLoad(false);\n    }\n  });\n  useEffect(() => {\n    (async () => {\n      if (authenticated && profile.role === 'client') {\n        if (localStorage.favorites && localStorage.favorites !== '[]') {\n          let favorites = JSON.parse(localStorage.favorites);\n          favorites = favorites.map(element => element._id);\n          await addFavoriteItem(favorites);\n          localStorage.favorites = _JSON$stringify([]);\n          if (getList !== undefined) await getList();\n        }\n\n        if (localStorage.basket && localStorage.basket !== '[]') {\n          let basket = JSON.parse(localStorage.basket);\n\n          for (let i = 0; i < basket.length; i++) {\n            await addBasket({\n              item: basket[i].item._id,\n              count: basket[i].count\n            });\n          }\n\n          localStorage.basket = '[]';\n          if (getList !== undefined) await getList();\n        }\n      }\n    })();\n  }, []);\n  const {\n    load\n  } = props.app;\n\n  let handleScroll = async () => {\n    console.log(mainWindow.current.pageYOffset + mainWindow.current.outerHeight, mainWindow.current.documentElement.offsetHeight - 506);\n  };\n\n  useEffect(() => {\n    mainWindow.current.addEventListener('scroll', handleScroll);\n    return () => {\n      mainWindow.current.removeEventListener('scroll', handleScroll);\n    };\n  });\n  return __jsx(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72\n    },\n    __self: this\n  }, __jsx(Drawer, {\n    subcategory: subcategory,\n    category: category,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }), __jsx(AppBar, {\n    dates: dates,\n    pageName: pageName,\n    sorts: sorts,\n    filters: filters,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    ref: mainWindow,\n    className: \"App-body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, props.children), __jsx(Dialog, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78\n    },\n    __self: this\n  }), __jsx(SnackBar, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79\n    },\n    __self: this\n  }), load ? __jsx(\"div\", {\n    className: \"load\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, __jsx(CircularProgress, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  })) : null);\n});\n\nfunction mapStateToProps(state) {\n  return {\n    user: state.user,\n    app: state.app\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    userActions: bindActionCreators(userActions, dispatch),\n    appActions: bindActionCreators(appActions, dispatch)\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);","map":{"version":3,"sources":["C:\\projects\\azyk\\azyk-admin\\layouts\\App.js"],"names":["React","useEffect","AppBar","Dialog","SnackBar","Drawer","connect","bindActionCreators","addFavoriteItem","addBasket","userActions","appActions","CircularProgress","Router","useRouter","mainWindow","createRef","App","memo","props","setProfile","logout","showLoad","profile","authenticated","user","sorts","filters","getList","pageName","dates","subcategory","category","router","role","events","on","err","url","pathname","includes","cancelled","localStorage","favorites","JSON","parse","map","element","_id","undefined","basket","i","length","item","count","load","app","handleScroll","console","log","current","pageYOffset","outerHeight","documentElement","offsetHeight","addEventListener","removeEventListener","children","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport AppBar from '../components/app/AppBar'\nimport Dialog from '../components/app/Dialog'\nimport SnackBar from '../components/app/SnackBar'\nimport Drawer from '../components/app/Drawer'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport { addFavoriteItem } from '../src/gql/items'\nimport { addBasket } from '../src/gql/basket'\nimport * as userActions from '../redux/actions/user'\nimport * as appActions from '../redux/actions/app'\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport '../scss/app.scss'\nimport Router from 'next/router'\nimport { useRouter } from 'next/router';\n\nexport const mainWindow = React.createRef();\n\nconst App = React.memo(props => {\n    const { setProfile, logout } = props.userActions;\n    const { showLoad } = props.appActions;\n    const { profile, authenticated } = props.user;\n    let { sorts, filters, getList, pageName, dates, subcategory, category } = props;\n    const router = useRouter();\n    useEffect( ()=>{\n        if(authenticated)\n            setProfile()\n        else if(!authenticated&&profile.role)\n            logout(false)\n    },[authenticated,])\n    Router.events.on('routeChangeStart', (err, url)=>{\n        if(!router.pathname.includes(url))\n            showLoad(true)\n        if (err.cancelled) {\n            showLoad(false)\n        }\n    })\n    useEffect( ()=>{\n        (async ()=>{\n            if(authenticated&&profile.role==='client'){\n                if(localStorage.favorites&&localStorage.favorites!=='[]') {\n                    let favorites = JSON.parse(localStorage.favorites)\n                    favorites = favorites.map(element => element._id)\n                    await addFavoriteItem(favorites)\n                    localStorage.favorites = JSON.stringify([])\n                    if (getList !== undefined)\n                        await getList()\n                }\n                if(localStorage.basket&&localStorage.basket!=='[]') {\n                    let basket = JSON.parse(localStorage.basket)\n                    for(let i=0; i<basket.length; i++){\n                        await addBasket({item: basket[i].item._id, count: basket[i].count})\n                    }\n                    localStorage.basket = '[]'\n                    if (getList !== undefined)\n                        await getList()\n                }\n            }\n        })()\n    },[])\n    const { load } = props.app;\n    let handleScroll =  async () => {\n        console.log(mainWindow.current.pageYOffset+mainWindow.current.outerHeight, mainWindow.current.documentElement.offsetHeight-506)\n    }\n    useEffect(()=>{\n        mainWindow.current.addEventListener('scroll', handleScroll);\n        return ()=>{\n            mainWindow.current.removeEventListener('scroll', handleScroll);\n        }\n    });\n    return(\n        <div className='App'>\n            <Drawer subcategory={subcategory} category={category}/>\n            <AppBar dates={dates} pageName={pageName} sorts={sorts} filters={filters}/>\n            <div ref={mainWindow} className='App-body'>\n                {props.children}\n            </div>\n            <Dialog />\n            <SnackBar/>\n            {load?\n                <div className='load'>\n                    <CircularProgress/>\n                </div>\n                :\n                null\n            }\n        </div>\n    )\n});\n\nfunction mapStateToProps (state) {\n    return {\n        user: state.user,\n        app: state.app,\n    }\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        userActions: bindActionCreators(userActions, dispatch),\n        appActions: bindActionCreators(appActions, dispatch),\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);"]},"metadata":{},"sourceType":"module"}